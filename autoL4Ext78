if newValue.value == 1:
	start = system.date.now()
	logger = system.util.getLogger("Cambio de Orden Extrusi칩n L4")
	
	#LIMPIO CANTIDADES DE LOCACIONES DE LIQUIDOS
	#Extuder 7 - 8
	tagPath = 'process/extrusion/wrhPL7Ext'
	tagWrite= [tagPath+'/binLiq01/wgtRecipe',
				tagPath+'/binLiq02/wgtRecipe',
				tagPath+'/binLiq03/wgtRecipe',
				tagPath+'/binLiq04/wgtRecipe',
				tagPath+'/binLiq05/wgtRecipe',
				tagPath+'/binLiq06/wgtRecipe',
				tagPath+'/binLiq07/wgtRecipe',
				tagPath+'/binLiq08/wgtRecipe',
				tagPath+'/binLiq09/wgtRecipe',
				tagPath+'/binLiq10/wgtRecipe']
	tagValue = [0,0,0,0,0,0,0,0,0,0]
	result = system.tag.writeBlocking(tagWrite, tagValue)
	
	#ORDENES OPEN AUTO 
	order55CM01=system.tag.readBlocking(["extrusion/productionLine7/extruder1/55CM01/codOrder"])[0].value
	subOrder55CM01=system.tag.readBlocking(["extrusion/productionLine7/extruder1/55CM01/codSubOrder"])[0].value
	order56CM01= system.tag.readBlocking(["extrusion/productionLine8/extruder1/56CM01/codOrder"])[0].value
	subOrder56CM01= system.tag.readBlocking(["extrusion/productionLine8/extruder1/56CM01/codSubOrder"])[0].value
	queryOrderL7="SELECT * FROM galProduction a INNER JOIN  galProCurExt b ON a.id = b.id where a.type = 'PS_EXTRUSION' and b.cmdStsFlag = 1 and a.moId like '%' + ? +'%' and a.indexs = ? "
	
	dataOrder1 = system.db.runPrepQuery(queryOrderL7,[order55CM01,subOrder55CM01])
	dataOrder2 = system.db.runPrepQuery(queryOrderL7,[order56CM01,subOrder56CM01])
	dataOrder = ''
	
	if len(dataOrder1) > 0:
		dataOrder = dataOrder1
	elif len(dataOrder2) > 0:
		dataOrder = dataOrder2
		
	if len(dataOrder) >0:
		id = dataOrder[0]['id']
		database = system.tag.readBlocking(["process/general/database"])[0].value #Base de Datos
		type = "PS_EXTRUSION"
		
		user = system.tag.readBlocking(["[System]Client/User/Username"])[0].value
		queryUpdate = "Update galProCurExt set [user] = ? where id = ?"
		system.db.runPrepUpdate(queryUpdate,[user,id])
		
		moId = dataOrder.getValueAt(0,'moId')
		index = dataOrder.getValueAt(0,'indexs')
		nrBatch = dataOrder.getValueAt(0,'nrOffBatches')
		destination = dataOrder.getValueAt(0,'destination')
		batchSeq = dataOrder.getValueAt(0,'batchSeqNo')
		equipmentID = dataOrder.getValueAt(0,'bEquipmentId')
		finalMatId = dataOrder.getValueAt(0, 'finalMatId')
		
		#Linea extrusi칩n
		dsg = int(equipmentID[-2:])
		#if dsg == 1 :	COMENTADO AA 20231011
		#	tagOrd1 = 'extrusion/productionLine1/extruder1/51CM01/codOrder'
		#	tagSubOrd1 = 'extrusion/productionLine1/extruder1/51CM01/codSubOrder'
		#	tagOrd2 = 'extrusion/productionLine1/extruder1/51CM02/codOrder'
		#	tagSubOrd2 = 'extrusion/productionLine1/extruder1/51CM02/codSubOrder'
		#elif dsg == 2 :
		#	tagOrd1 = 'extrusion/productionLine2/extruder3/52CM01/codOrder'
		#	tagSubOrd1 = 'extrusion/productionLine2/extruder3/52CM01/codSubOrder'
		#	tagOrd2 = 'extrusion/productionLine2/extruder3/52CM02/codOrder'
		#	tagSubOrd2 = 'extrusion/productionLine2/extruder3/52CM02/codSubOrder'
		if dsg == 9 :
			tagOrd1 = 'extrusion/productionLine9/extruder1/57CM01/codOrder'
			tagSubOrd1 = 'extrusion/productionLine9/extruder1/57CM01/codSubOrder'
			tagOrd2 = 'extrusion/productionLine9/extruder1/57CM01/codOrder'
			tagSubOrd2 = 'extrusion/productionLine9/extruder1/57CM01/codSubOrder'
		#elif dsg == 10 :
		#	tagOrd1 = 'extrusion/productionLine10/extruder1/58CM02/codOrder'
		#	tagSubOrd1 = 'extrusion/productionLine10/extruder1/58CM02/codSubOrder'
		#	tagOrd2 = 'extrusion/productionLine10/extruder1/58CM02/codOrder'
		#	tagSubOrd2 = 'extrusion/productionLine10/extruder1/58CM02/codSubOrder'
		else:
			tagOrd1 = 'extrusion/productionLine7/extruder1/55CM01/codOrder'
			tagSubOrd1 = 'extrusion/productionLine7/extruder1/55CM01/codSubOrder'
			tagOrd2 = 'extrusion/productionLine8/extruder1/56CM01/codOrder'
			tagSubOrd2 = 'extrusion/productionLine8/extruder1/56CM01/codSubOrder'
			
		
		codOrdGpm = system.tag.readBlocking([tagOrd1])[0].value
		codSubOrdGpm = system.tag.readBlocking([tagSubOrd1])[0].value
		codOrdGpm2 = system.tag.readBlocking([tagOrd2])[0].value
		codSubOrdGpm2 = system.tag.readBlocking([tagSubOrd2])[0].value
	
		if (moId == codOrdGpm) or (moId == codOrdGpm2):
		
			tag = "process/extrusion/wrhPL"+str(dsg)+"Ext"
			tagId = tag + "/codOrderId"
			tagModId = tag + "/codOrder"
			tagIndex = tag + "/codSubOrder"
			tagNrBatch = tag + "/batchTotal"
			tagBatchSeq = tag + "/batchCurrent"
			tagStart = tag + "/start"
			tagFinalMatId = tag + 'FinalMatId'
					
			system.tag.writeAsync([tagId],[id])
			system.tag.writeAsync([tagModId],[moId])
			system.tag.writeAsync([tagIndex],[index])	
			system.tag.writeAsync([tagNrBatch],[nrBatch])
			system.tag.writeAsync([tagBatchSeq],[batchSeq])
			system.tag.writeAsync([tagFinalMatId],[finalMatId])
			
			queryMce = "Select * from galMceBatch where id = ? and type = ?"
			dataMce = system.db.runPrepQuery(queryMce,[id,type])
			
			#Cargar los ingredientes para la receta	
			for j in range (dataMce.getRowCount()):
				seq = dataMce.getValueAt(j,'mceSeq')
				cod = dataMce.getValueAt(j,'mceMaterialDefinitionId')
				loc = dataMce.getValueAt(j,'mceLocationId')			
				qua = dataMce.getValueAt(j,'mceQuantity')
				
				#Cargar los ingredientes en los codigos de unidad	
				#queryBin = ("select unit from galSilo where siloCode = ?")
				#bintag = system.db.runPrepQuery(queryBin,[loc])
				
				# Asignacion Manual Bines Dosificacion
				if loc == '90CM01' :
					bintag = 'binLiq01'
				elif loc == '90CM02' :
					bintag = 'binLiq02'
				elif loc == '90CM03' :
					bintag = 'binLiq03'
				elif loc == '95CM01' :
					bintag = 'binLiq04'
				elif loc == 'AGUA' :
					bintag = 'binLiq05'		#AGUA			
				elif loc == '95CM04' :
					bintag = 'binLiq06'
				elif loc == '95CM05' :
					bintag = 'binLiq07'
				elif loc == '95CM09' :
					bintag = 'binLiq08'
				else:
					bintag = 'binLiq09'
				
				# Exite un c칩digo de Bin v치lido para el producto
				#if bintag.getRowCount() != 0:
				# Crear los paths para cargar los datos
				ingCod = tag + "/" + bintag + "/ingCod"
				wgt = tag + "/" + bintag + "/wgtRecipe"
				# Escribir los valores en los tags
				system.tag.writeAsync([wgt],[qua])
				system.tag.writeAsync([ingCod],[cod])
		
			# Cargo los parametros de la receta			
			queryParam = "Select name, value from galBatchParam where id = ? and type = ? and name like 'Ex%' ORDER BY id DESC"
			dataParam = system.db.runPrepQuery(queryParam,[id,type])
		
			for i in range (dataParam.getRowCount()):	
				name = dataParam.getValueAt(i,0)
				value = dataParam.getValueAt(i,1)
			
				sp = tag + "/extSp"  + "/sp" + name[-2:]
				#system.tag.writeAsync([sp],[value])
		
					
			
			# Reportar inicio de Secuencia en Asistido Manual
			
			#if dsg == 1 : 	COMENTADO AA 20231011
			#	tagAutoMan = 'extrusion/productionLine1/51/autoMan'
			#	tagStarted = 'extrusion/productionLine1/51/started'
			#elif dsg == 2 : 
			#	tagAutoMan = 'extrusion/productionLine2/52/autoMan'
			#	tagStarted = 'extrusion/productionLine2/52/started'
			if dsg == 9 : 
				tagAutoMan = 'extrusion/productionLine9/57/autoMan'
				tagStarted = 'extrusion/productionLine9/57/started'
			#elif dsg == 10 : 
			#	tagAutoMan = 'extrusion/productionLine10/58/autoMan'
			#	tagStarted = 'extrusion/productionLine10/58/started'
			else:
				tagAutoMan = 'extrusion/productionLine7/55/autoMan'
				tagStarted = 'extrusion/productionLine7/55/started'
				
			autoMan = system.tag.readBlocking([tagAutoMan])[0].value
			started = system.tag.readBlocking([tagStarted])[0].value
		#	if (not autoMan) or (autoMan and not started):
				# Escribe datos en almacen para reportes - Manual y Asistido Manual	
				
		#		if dsg == 1:
					
		#			tagStart = 'extrusion/productionLine' + str(dsg) + '/extruder1/hmiStartExtOrderProduction'
		#		elif dsg == 2 : 
						
		#			tagStart = 'extrusion/productionLine' + str(dsg) + '/extruder3/hmiStartExtOrderProduction'
		#		else:
		#			tagStart = 'extrusion/productionLine' + str(dsg) + '/extruder1/hmiStartExtOrderProduction'
		#		system.tag.writeAsync([tagStart],[1])
		#		queryUpdate = 'UPDATE galProCurExt SET cmdStsFlag = 2 WHERE id = ?'
		#		system.db.runPrepUpdate(queryUpdate, [id])
				
	end = system.date.now()    
	elapsed = system.date.millisBetween(start, end)    
	logger.info("scripTiming_tagChange_autoL4Ext78: " + str(elapsed) + "ms")		
