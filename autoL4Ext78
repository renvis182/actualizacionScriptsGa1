if newValue.value == 1:
	start = system.date.now()
	logger = system.util.getLogger("Cambio de Orden Extrusión L4")
	
	#LIMPIO CANTIDADES DE LOCACIONES DE LIQUIDOS
	#Extuder 7 - 8
	tagPath = 'process/extrusion/wrhPL7Ext'
	tagWrite= [tagPath+'/binLiq01/wgtRecipe',
				tagPath+'/binLiq02/wgtRecipe',
				tagPath+'/binLiq03/wgtRecipe',
				tagPath+'/binLiq04/wgtRecipe',
				tagPath+'/binLiq05/wgtRecipe',
				tagPath+'/binLiq06/wgtRecipe',
				tagPath+'/binLiq07/wgtRecipe',
				tagPath+'/binLiq08/wgtRecipe',
				tagPath+'/binLiq09/wgtRecipe',
				tagPath+'/binLiq10/wgtRecipe']
	tagValue = [0,0,0,0,0,0,0,0,0,0]
	result = system.tag.writeBlocking(tagWrite, tagValue)
	
	#ORDENES OPEN AUTO 
	readBlockingTags = {
		"order55CM01":"extrusion/productionLine7/extruder1/55CM01/codOrder",
		"subOrder55CM01":"extrusion/productionLine7/extruder1/55CM01/codSubOrder",
		"order56CM01":"extrusion/productionLine8/extruder1/56CM01/codOrder",
		"subOrder56CM01":"extrusion/productionLine8/extruder1/56CM01/codSubOrder",
	
		"database":"process/general/database",
		"user":"[System]Client/User/Username",
	
		"tagOrd1Cond1":"extrusion/productionLine9/extruder1/57CM01/codOrder",
		"tagSubOrd1Cond1":"extrusion/productionLine9/extruder1/57CM01/codSubOrder",
		"tagOrd2Cond1":"extrusion/productionLine9/extruder1/57CM01/codOrder",
		"tagSubOrd2Cond1":"extrusion/productionLine9/extruder1/57CM01/codSubOrder",
	
		"tagOrd1Cond2":"extrusion/productionLine7/extruder1/55CM01/codOrder",
		"tagSubOrd1Cond2":"extrusion/productionLine7/extruder1/55CM01/codSubOrder",
		"tagOrd2Cond2":"extrusion/productionLine8/extruder1/56CM01/codOrder",
		"tagSubOrd2Cond2":"extrusion/productionLine8/extruder1/56CM01/codSubOrder",
	
		"tagAutoManCond1":"extrusion/productionLine9/57/autoMan",
		"tagStartedCond1":"extrusion/productionLine9/57/started",
		"tagAutoManCond2":"extrusion/productionLine7/55/autoMan",
		"tagStartedCond2":"extrusion/productionLine7/55/started"
	}

	readKeys = [
	    "order55CM01", "subOrder55CM01", 
		"order56CM01", "subOrder56CM01",
	    "database", "user",
	    "tagOrd1Cond1", "tagSubOrd1Cond1", 
		"tagOrd2Cond1", "tagSubOrd2Cond1",
	    "tagOrd1Cond2", "tagSubOrd1Cond2", 
		"tagOrd2Cond2", "tagSubOrd2Cond2",
	    "tagAutoManCond1", "tagStartedCond1", 
		"tagAutoManCond2", "tagStartedCond2"
	]

	tagPaths     = [readBlockingTags[i] for i in readKeys]
	readingTags  = system.tag.readBlocking(tagPaths)
	tagValues    = dict(zip(readKeys, [r.value for r in readingTags]))

	order55CM01 = tagValues["order55CM01"]
	subOrder55CM01 = tagValues["subOrder55CM01"]
	order56CM01 = tagValues["order56CM01"]
	subOrder56CM01 = tagValues["subOrder56CM01"]

	queryOrderL7="SELECT * FROM galProduction a INNER JOIN  galProCurExt b ON a.id = b.id where a.type = 'PS_EXTRUSION' and b.cmdStsFlag = 1 and a.moId like '%' + ? +'%' and a.indexs = ? "

	dataOrder1 = system.db.runPrepQuery(queryOrderL7,[order55CM01,subOrder55CM01])
	dataOrder2 = system.db.runPrepQuery(queryOrderL7,[order56CM01,subOrder56CM01])
	dataOrder = ''

	if len(dataOrder1) > 0:
		dataOrder = dataOrder1
	elif len(dataOrder2) > 0:
		dataOrder = dataOrder2
	
	if len(dataOrder) >0:
		id = dataOrder[0]['id']
		database = tagValues["database"]
		type = "PS_EXTRUSION"
		user = tagValues["user"]
		writeBlockingTags = {}
	
		queryUpdate = "Update galProCurExt set [user] = ? where id = ?"
		system.db.runPrepUpdate(queryUpdate,[user,id])
	
		moId = dataOrder.getValueAt(0,'moId')
		index = dataOrder.getValueAt(0,'indexs')
		nrBatch = dataOrder.getValueAt(0,'nrOffBatches')
		destination = dataOrder.getValueAt(0,'destination')
		batchSeq = dataOrder.getValueAt(0,'batchSeqNo')
		equipmentID = dataOrder.getValueAt(0,'bEquipmentId')
		finalMatId = dataOrder.getValueAt(0, 'finalMatId')
	
		#Linea extrusión
		dsg = int(equipmentID[-2:])
	
		if dsg == 9 :
			tagOrd1 = tagValues["tagOrd1Cond1"]
			tagSubOrd1 = tagValues["tagSubOrd1Cond1"]
			tagOrd2 = tagValues["tagOrd2Cond1"]
			tagSubOrd2 = tagValues["tagSubOrd2Cond1"]
		else:
			tagOrd1 = tagValues["tagOrd1Cond2"]
			tagSubOrd1 = tagValues["tagSubOrd1Cond2"]
			tagOrd2 = tagValues["tagOrd2Cond2"]
			tagSubOrd2 = tagValues["tagSubOrd2Cond2"]
	
		codOrdGpm = tagOrd1
		codSubOrdGpm = tagSubOrd1
		codOrdGpm2 = tagOrd2
		codSubOrdGpm2 = tagSubOrd2

		if (moId == codOrdGpm) or (moId == codOrdGpm2):
			tag = "process/extrusion/wrhPL"+str(dsg)+"Ext"
			tagId = tag + "/codOrderId"
			tagModId = tag + "/codOrder"
			tagIndex = tag + "/codSubOrder"
			tagNrBatch = tag + "/batchTotal"
			tagBatchSeq = tag + "/batchCurrent"
			tagStart = tag + "/start"
			tagFinalMatId = tag + 'FinalMatId'
				
			writeBlockingTags = {
				tagId:id,
				tagModId:moId,
				tagIndex:index,
				tagNrBatch:nrBatch,
				tagBatchSeq:batchSeq,
				tagFinalMatId:finalMatId
			}
		
			queryMce = "Select * from galMceBatch where id = ? and type = ?"
			dataMce = system.db.runPrepQuery(queryMce,[id,type])
		
			#Cargar los ingredientes para la receta	
			for j in range (dataMce.getRowCount()):
				seq = dataMce.getValueAt(j,'mceSeq')
				cod = dataMce.getValueAt(j,'mceMaterialDefinitionId')
				loc = dataMce.getValueAt(j,'mceLocationId')			
				qua = dataMce.getValueAt(j,'mceQuantity')
			
				# Asignacion Manual Bines Dosificacion
				if loc == '90CM01' :
					bintag = 'binLiq01'
				elif loc == '90CM02' :
					bintag = 'binLiq02'
				elif loc == '90CM03' :
					bintag = 'binLiq03'
				elif loc == '95CM01' :
					bintag = 'binLiq04'
				elif loc == '95CM02' :
					bintag = 'binLiq05'			
				elif loc == '95CM04' :
					bintag = 'binLiq06'
				elif loc == '95CM05' :
					bintag = 'binLiq07'
				elif loc == '95CM09' :
					bintag = 'binLiq08'
				else:
					bintag = 'binLiq09'
			
				# Crear los paths para cargar los datos
				ingCod = tag + "/" + bintag + "/ingCod"
				wgt = tag + "/" + bintag + "/wgtRecipe"
				# Escribir los valores en los tags
				writeBlockingTags[wgt] = qua
				writeBlockingTags[ingCod] = cod
	
			# Cargo los parametros de la receta			
			queryParam = "Select name, value from galBatchParam where id = ? and type = ? and name like 'Ex%' ORDER BY id DESC"
			dataParam = system.db.runPrepQuery(queryParam,[id,type])
	
			for i in range (dataParam.getRowCount()):	
				name = dataParam.getValueAt(i,0)
				value = dataParam.getValueAt(i,1)
				sp = tag + "/extSp"  + "/sp" + name[-2:]
		
			if dsg == 9 : 
				tagAutoMan = tagValues["tagAutoManCond1"]
				tagStarted = tagValues["tagStartedCond1"]
			else:
				tagAutoMan = tagValues["tagAutoManCond2"]
				tagStarted = tagValues["tagStartedCond2"]
			autoMan = tagAutoMan
			started = tagStarted
	
		if writeBlockingTags:
			system.tag.writeBlocking(list(writeBlockingTags.keys()), list(writeBlockingTags.values()))
		# Modificado por Renato Dueñas bitches
	end = system.date.now()    
	elapsed = system.date.millisBetween(start, end)    
	logger.info("scripTiming_tagChange_autoL4Ext78: " + str(elapsed) + "ms")
