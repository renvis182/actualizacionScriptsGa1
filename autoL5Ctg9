if newValue.value == 1:
	start = system.date.now()
	# lOGGER INICIO SCRIPT
	logger = system.util.getLogger("autoStartL5Ctg9")
	logger.info("Ejecucion Script Arranque Automatico Orden Coating L5")
	
	#LIMPIO CANTIDADES DE LOCACIONES DE LIQUIDOS
	#Coating 9
	tagPath = 'process/extrusion/wrhPL9Ctg'
	tagWrite= [tagPath+'/binLiq01/wgtRecipe',
				tagPath+'/binLiq02/wgtRecipe',
				tagPath+'/binLiq03/wgtRecipe',
				tagPath+'/binLiq04/wgtRecipe',
				tagPath+'/binLiq05/wgtRecipe',
				tagPath+'/binLiq06/wgtRecipe',
				tagPath+'/binLiq07/wgtRecipe',
				tagPath+'/binLiq08/wgtRecipe',
				tagPath+'/binLiq09/wgtRecipe',
				tagPath+'/binLiq10/wgtRecipe']
	tagValue = [0,0,0,0,0,0,0,0,0,0]
	result = system.tag.writeBlocking(tagWrite, tagValue)
	
	# TOMA DATOS DE CODIGO ORDEN EN LAS EN LAS BALANZAS LIW 57AW01
	readBlockingTags = {
	    "order57AW01":    "[default]extrusion/productionLine9/extruder1/57AW01/codOrder",
	    "subOrder57AW01": "[default]extrusion/productionLine9/extruder1/57AW01/codSuborder",
	    "database":       "process/general/database"
	}

	readKeys   = ["order57AW01", "subOrder57AW01", "database"]
	tagPaths   = [readBlockingTags[k] for k in readKeys]
	reading    = system.tag.readBlocking(tagPaths)
	tagValues  = dict(zip(readKeys, [r.value for r in reading]))

	order57AW01 = tagValues["order57AW01"]
	subOrder57AW01 = tagValues["subOrder57AW01"]
	queryOrderL1 = "SELECT * FROM galProduction a INNER JOIN galProCurCoa b ON a.id = b.id where a.type = 'PS_COATING' and b.cmdStsFlag = 1 and a.moId = ? and a.indexs = ?"

	# CONSULTA SI EXISTE CODIGO ORDEN EN BALANZAS  57AW01  VALIDO PARA REALIZAR EL QUERY
	if order57AW01 != '' and len(order57AW01) == 10 :
		dataOrder1 = system.db.runPrepQuery(queryOrderL1,[order57AW01,subOrder57AW01])
		logger.info("EXISTE NUMERO DE ORDEN VALIDO 57AW01")
	else:
		dataOrder1 = ''
		logger.info("NO EXISTE NUMERO DE ORDEN VALIDO 57AW01")
	
	# CONSULTA FILAS EXISTENTES DEL RESULTADO QUERY Y ACTUALIZA dataOrder 
	if len(dataOrder1) > 0:
		dataOrder = dataOrder1
	elif len(dataOrder2) > 0:
		dataOrder = dataOrder2
	else:
		dataOrder = ''
	
	if len(dataOrder) >0:
		id = dataOrder[0]['id']
		database = tagValues["database"]
		type = "PS_COATING"
		writeBlockingTags = {}

	# ACTUALIZA TABLA USUARIO galProCurCoa TOMANDO EL id DE LA ORDEN		
		user = 'ignGtwy' #system.tag.readBlocking(['[System]Client/User/Username'])[0].value
		queryUpdate = "Update galProCurCoa set [user] = ? where id = ?"
		system.db.runPrepUpdate(queryUpdate,[user,id])
		dataCurr = system.db.runPrepQuery('SELECT batchSeqNo FROM galProCurCoa where id = ?',[id])
	
	# INFORMACION DE LA ORDEN galProduction TOMANDO codOrder 52AW01/52AW02 
		moId = dataOrder.getValueAt(0,'moId')
		index = dataOrder.getValueAt(0,'indexs')
		batchSeq =  (dataCurr[0][0] if dataCurr[0][0] == 'None' else 0)
		nrBatch = dataOrder.getValueAt(0,'nrOffBatches')
		equipmentID = dataOrder.getValueAt(0,'bEquipmentId')
	
		#Linea extrusión
		dsg = int(equipmentID[-2:])
	
		#Verificacion de orden para Dinnisen
		if dsg == 9 or dsg == 5:
			destination = dataOrder[0]['destination']
			if destination =='DINNISSEN' :
				dsg = int(str(dsg) + str(dsg))
	
	# SE ARMA EL PATH DEL WAREHOUSE
		ctgL5Dsg = 'process/extrusion/ChangeOrderCtg/flag/ctgL5Dsg'
		ctgL5DinnFlag = 'process/extrusion/ChangeOrderCtg/flag/ctgL5DinnFlag'	
		tag = "process/extrusion/wrhPL"+str(dsg)+"Ctg"
		status = tag + "/status"
		tagId = tag + "/codOrderId"
		tagModId = tag + "/codOrder"
		tagIndex = tag + "/codSubOrder"
		tagNrBatch = tag + "/batchTotal"
		tagBatchSeq = tag + "/batchCurrent"
		tagStart = tag + "/start"
		tagRecipe = tag + "/codRec"
				
	# ESCRIBE INFORMARCION DE LA ORDEN EN EL WHAREHOUSE
		writeBlockingTags = {
			tagId:id,
			tagModId:moId,
			tagIndex:index,
			tagNrBatch:nrBatch,
			tagBatchSeq:batchSeq
		}

		nameRecipe = moId + ' ' + dataOrder.getValueAt(0,'finalMatDesc')
		writeBlockingTags[tagRecipe] = nameRecipe
		writeBlockingTags[ctgL5Dsg] = dsg
		if dsg == 99:
			writeBlockingTags[ctgL5DinnFlag] = 1
		else:
			writeBlockingTags[ctgL5DinnFlag] = 0
			
		queryMce = "Select * from galMceBatch where id = ? and type = ?"
		dataMce = system.db.runPrepQuery(queryMce,[id,type])
			
	#Cargar los ingredientes para la receta	
		for i in range (dataMce.getRowCount()):
			seq = dataMce.getValueAt(i,4)
			cod = dataMce.getValueAt(i,5)
			loc = dataMce.getValueAt(i,8)			
			qua = dataMce.getValueAt(i,9)
		
			#Cargar los ingredientes en los codigos de unidad	
			queryBin = ("select unit from galSilo where siloCode = ?")
			bintag = system.db.runPrepQuery(queryBin,[loc])
		
			# Exite un código de Bin válido para el producto
			if bintag.getRowCount() != 0:
				ingCod = tag + "/" + str(bintag[0][0]) + "/ingCod"
				wgt = tag + "/" + str(bintag[0][0]) + "/wgtRecipe"
				writeBlockingTags[wgt] = qua
				writeBlockingTags[ingCod] = cod

		#Cargo los parametros de la receta			
		queryParam = "Select * from galBatchParam where id = ? and type = ?"
		dataParam = system.db.runPrepQuery(queryParam,[id,type])

		for i in range (dataParam.getRowCount()):	
			name = dataParam.getValueAt(i,0)
			value = dataParam.getValueAt(i,1)
		
			#solo estan habilitados 3 setpoints en el UDT
			if int(name[-2:]) <= 3:		
				sp = tag + "/coSp"  + "/sp" + name[-2:]
				writeBlockingTags[sp] = value
			
	if writeBlockingTags:
		system.tag.writeBlocking(list(writeBlockingTags.keys()), list(writeBlockingTags.values()))
	end = system.date.now()    
	elapsed = system.date.millisBetween(start, end)    
	logger.info("scripTiming_tagChange_autoL5Ctg9: " + str(elapsed) + "ms")
