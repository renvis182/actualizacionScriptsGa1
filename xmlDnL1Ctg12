if  newValue.value == 4:
	extLine = 1
	logger = system.util.getLogger("Gtwy_ChangeOrder")
	logger.info("Start: Close order by Auto Mode  for Line " + str(extLine))

	type = "PS_COATING"
	readBlockingTags = {
		"database":"process/general/database",
		"id":"process/extrusion/flagCtg/flagStartCtgL1/codId",
		"moId":"process/extrusion/flagCtg/flagDnCtgL" + str(extLine) + "/codOrder",
		"index":"process/extrusion/flagCtg/flagDnCtgL" + str(extLine) + "/codSubOrder",
		"BatchSeqNo":"process/extrusion/flagCtg/flagDnCtgL" + str(extLine) + "/flagBatch"
	}
	tagPaths = list(readBlockingTags.values())
	readingTags = system.tag.readBlocking(tagPaths)
	tagValues = dict(zip(readBlockingTags.keys(),[r.value for r in readingTags]))

	database = tagValues["database"]
	id = tagValues["id"]
	logger.info("Ctg Order Old: " + str(id))

	#Cambiar de estado de la orden en nuevas tablas del sistema Menta	
	user = 'gateway'
	shared.pcsMentaComms.actionWorkOrder(id, 'Completed', user)
	shared.pcsMentaComms.actionProductionOrder(id, 'Completed', user)

	moId = tagValues["moId"]
	index = tagValues["index"]
	BatchSeqNo = tagValues["BatchSeqNo"]

	queryProd = "Select * from galProduction where moId = ? and indexs = ? and type = ?"
	dataProd = system.db.runPrepQuery(queryProd,[moId,index,type])
	idNew = dataProd.getValueAt(0,"id")
	logger.info("Ctg Order New: " + str(idNew))

	status = 0
	date = system.date.now()

	#Traigo la informacion de las tablas de acuero al Id seleccionado
	queryProd = "Select * from galProduction where id = ? and type = ?"
	dataProd = system.db.runPrepQuery(queryProd,[id,type])

	queryUpdate = "Update galProCurCoa set  cmdStsFlag = ?, status = ? ,dateEndBatch = ? where id = ?"
	system.db.runPrepUpdate(queryUpdate,[newValue.value,status,date,id])
	
	queryProdC = "Select * from galProCurCoa where id = ?"
	dataProdC = system.db.runPrepQuery(queryProdC,[id])

	batchSeqNo = dataProdC[0]["batchSeqNo"]
	queryUpdate = "Insert into galProSeqCoa (id,date,cmdStsFlag ,batchSeqNo) values (?,?,?,?) "
	system.db.runPrepUpdate(queryUpdate,[id,date,newValue.value,batchSeqNo])

	#Cambiar de estado de la orden en nuevas tablas del sistema Menta	
	user = 'gateway'
	shared.pcsMentaComms.actionWorkOrder(id, 'Completed', user)
	shared.pcsMentaComms.actionProductionOrder(id, 'Completed', user)

	tagPaths = [
		"process/extrusion/flagCtg/flagDnCtgL1/flag",
		"process/extrusion/flagCtg/flagDnCtgL1/flag",
		"process/extrusion/flagCtg/flagDnCtgL1/codId"
	]
	values = [0,0,""]
	system.tag.writeBlocking(tagPaths, values)

	date = system.date.now()
	dateTime = system.date.format(date, "yyyyMMddHHmmss")
	logger.info("Finnish: The order has been closed by Auto Mode for Line " + str(extLine) + "at " + str(dateTime))

	### Initiating comments previous to read/write efficiency change ###	
	#import xml.dom.minidom #llamo a la libreria DOM
	#from xml.dom.minidom import parse, parseString #creo parametros para usar las funciones del DOM

	#MSGID = dataProd.getValueAt(0,"msgId")
	#CMDSTSFLAG = str(dataProdC.getValueAt(0,"cmdStsFlag"))

	#xml = shared.fileXml.answerProduction (MSGID,CMDSTSFLAG)
	#dom = parseString(xml)#transformo el archivo para manejarlo como xml
	#doc = dom.childNodes #Devuelve un array con todos los nodos hijos que contiene el nodo.

	#Agrego los datos a los nodos del xml		
	#nodos=dom.getElementsByTagName("ID")[0].childNodes[0] #carga los atributos del elemento (del XML)
	#nodos.nodeValue = dataProd.getValueAt(0,"bId") #le pongo el nuevo valor 
	
	#nodos=dom.getElementsByTagName("BatchSeqNo")[0].childNodes[0] #carga los atributos del elemento (del XML)
	#nodos.nodeValue = dataProdC.getValueAt(0,"batchSeqNo") #le pongo el nuevo valor 

	#nodos=dom.getElementsByTagName("EquipmentID")[0].childNodes[0] #carga los atributos del elemento (del XML)
	#nodos.nodeValue = dataProdC.getValueAt(0,"bEquipmentId") #le pongo el nuevo valor 

	#newDoc = dom.toprettyxml(indent="", newl="", encoding="utf-8")
					
	#Gurdar el archivo en el directorio indicado
	#dateTime = system.date.format(date, "yyyyMMddHHmmss")
	#name = "prodCtg12L1_toMes" + dataProdC.getValueAt(0,1) + "_CMDSTS" + str(newValue.value) + "_Finish_" + str(batchSeqNo) + "_" + dateTime + ".xml"
	#shared.fileXml.saveFile (name,newDoc)

	#Guardar el archivo en el directorio indicado para los DONE
	#tagPath = 'process/general/address/dn'
	#shared.fileXml.saveFileAdr (name, newDoc, tagPath)
	### Ending comments previous to read/write efficiency change ###	
